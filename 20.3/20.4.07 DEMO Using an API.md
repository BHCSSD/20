# 20.4.07 Demo: Using an API
```
20.4.07 Demo: Using an API
```
**Things to focus on:**
* how to load JSON data from an online API, parse it, and display character information 

> [!NOTE]
> ## INFODUMP:
>  **What is an API? (Application Programming Interface)**
> 
> | Concept                    | Explanation                                                                                                                                                                                                         |
> | -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
> | **Definition**             | An **API** is a set of rules that allows **different software programs to communicate with each other**. It defines **how requests and responses should work** between systems. |
> | **Purpose**                | APIs let you **access data or functionality** from another program, service, or website without needing to know how it’s implemented internally.                                                                    |
> | **Analogy**     | Think of an API like a **restaurant menu**. You don’t need to know how the chef cooks; you just tell the waiter what you want and get your food. The API is the menu that defines what you can request and how.     |
> | **Example in programming** | **Web API:** You can request weather data from an online service (like OpenWeatherMap) via a URL, and it returns JSON with temperature, humidity, etc.                                                            |
> 
> * **Library API:** p5.js provides functions like `createCanvas()` or `ellipse()`. The API tells you how to use them. 
>     *  **How it works** 
>      1. You **send a request** using the API (like calling a function or sending an HTTP request).
> 
>     2. The system **processes your request**.
>    3. You **receive a response** with the requested data or result. 
>
> 
> * Allows integration between different programs
> * Hides internal complexity (you don’t need to know how the system works inside) 
>   
>  **Key Terms** 
> * **Endpoint:** The URL or function you call.
> * **Request:** What you ask the API to do.
> * **Response:** What the API gives you back.
> * **JSON / XML:** Common formats for API responses. 
> 
> ---



## Step 1: Understand the API

* The Simpsons API endpoint for a single character is:

    ```
    https://thesimpsonsapi.com/api/characters/1
    ```

* Example response (JSON):

    ```json
    {
    "id": 1,
    "age": 39,
    "birthdate": "1956-05-12",
    "gender": "Male",
    "name": "Homer Simpson",
    "occupation": "Safety Inspector",
    "portrait_path": "/character/1.webp",
    "phrases": [
        "Doh!",
        "Woo-hoo!",
        "Mmm... (food)... *drooling*"
    ],
    "status": "Alive"
    }
    ```

**Key points:**

* Each field has a **key** and a **value**.
* `phrases` is an **array** of strings.
<!-- * `portrait_path` is a relative URL, we need the URL to display it. -->

---

## Step 2: Set up your p5.js sketch

1. Create a canvas.
2. Set up a variable to store the character data.
3. Use an **async function** to fetch the JSON data from the API.

    ```javascript
    let character; // Will store API data


    async function loadStuff() {
        // Use loadJSON() to get the API data
        const data = await loadJSON("https://thesimpsonsapi.com/api/characters/1");

        // Store the data globally
        character = data;
    }

    ```

---

## Step 3: Setup canvas and call async function

```javascript
function setup() {
  createCanvas(600, 800);
  
  textSize(14);
  textAlign(LEFT, TOP);
  background(220);
  
  // Call async function to load JSON
  loadStuff();
}
```

---

## Step 4: Display data in draw()

* Use a **check if data exists** (`if (character)`) so we don’t try to draw before it’s loaded.
* Show name, age, occupation, status, and phrases.
* Display the portrait image.

```javascript
function draw() {
  background(240);

  if (character) {
    textSize(16);
    text("Name: " + character.name, 20, 20);
    text("Age: " + character.age, 20, 50);
    text("Occupation: " + character.occupation, 20, 80);
    text("Status: " + character.status, 20, 110);

    // Show phrases (array)
    text("Phrases:", 20, 140);
    for (let i = 0; i < character.phrases.length; i++) {
      text("- " + character.phrases[i], 40, 170 + i * 20);
    }

    // Show portrait image
    let imgUrl = "https://thesimpsonsapi.com" + character.portrait_path;
    loadImage(
      imgUrl,
      function(img) {  // Success callback
        image(img, 400, 20, 150, 150);
      },
      function() {  // Error callback
        text("Image not found", 400, 20);
      }
    );
  } else {
    text("Loading character...", 20, 20);
  }
}
```

---

**What’s happening here:**

* `fetch(url)` retrieves the raw JSON from the API.
* `await response.json()` converts JSON into a **JavaScript object**.
* We store it in a global variable `character`.
* `phrases` is an **array**, so we use a `for` loop to display each phrase.
* Images are loaded asynchronously using `loadImage(url, success, error)` so the sketch doesn’t freeze.
* Always check `if (character)` in `draw()` to avoid errors before the data is loaded.

---

## Challenge

1. Change the URL to fetch a different character (e.g., `https://thesimpsonsapi.com/api/characters/5`).
2. Display multiple characters on the canvas.
3. Randomly pick a character each time the sketch runs.

